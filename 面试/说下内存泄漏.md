## JS中的垃圾回收算法

JS中的垃圾回收算法有两个版本:

- 引用计数
- 标记清除

js 是自动 gc的语言，开发者只会感知内存的使用。

## 引用计数算法

简单描述：对象被其他对象引用，那么就不能被垃圾回收

原理：每个对象都有属性值，来标识它被引用的次数，为0时可以被垃圾回收。

```js
let a = {
    key1: {
        name: 'test'
    }
}

let b = a 
let c = a.key1

b = null // 释放引用
c = null 

// 缺陷被循环引用，无法回收内存
function f() {
    let a = {}
    let b = {}

    a.key1 = b
    b.key1 = a 
}

f()
```

## 标记清除算法 

原理：假设有个root对象，垃圾回收器周期从根开始，找到所有从根开始引用的对象，然后找这些对象引用的对象...存在引用的对象标记，不存在的清除。

```js
function f() {
  let a = {};
  let b = {}; // 函数执行完后，不在树上
  // a, b循环引用
  a.key1 = b;
  b.key1 = a;
}

f();
```